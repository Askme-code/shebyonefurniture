{
  "entities": {
    "Product": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Product",
      "type": "object",
      "description": "Represents a furniture product in the Shaaban Furniture catalog.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Product entity."
        },
        "name": {
          "type": "string",
          "description": "The name of the product."
        },
        "price": {
          "type": "number",
          "description": "The price of the product."
        },
        "description": {
          "type": "string",
          "description": "A detailed description of the product."
        },
        "category": {
          "type": "string",
          "description": "The category the product belongs to (e.g., Beds, Sofas, Chairs)."
        },
        "images": {
          "type": "array",
          "description": "An array of URLs pointing to the product's images in Firebase Storage.",
          "items": {
            "type": "string"
          }
        },
        "stock": {
          "type": "number",
          "description": "The number of units of the product currently in stock."
        },
        "featured": {
          "type": "boolean",
          "description": "Indicates whether the product is featured or not."
        },
        "createdAt": {
          "type": "string",
          "description": "The date and time when the product was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "name",
        "price",
        "description",
        "category",
        "images",
        "stock",
        "featured",
        "createdAt"
      ]
    },
    "Order": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Order",
      "type": "object",
      "description": "Represents a customer order.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Order entity."
        },
        "customerName": {
          "type": "string",
          "description": "The name of the customer who placed the order."
        },
        "phone": {
          "type": "string",
          "description": "The customer's phone number."
        },
        "address": {
          "type": "string",
          "description": "The customer's shipping address."
        },
        "items": {
          "type": "array",
          "description": "An array of product IDs and quantities in the order.",
          "items": {
            "type": "string"
          }
        },
        "total": {
          "type": "number",
          "description": "The total price of the order."
        },
        "status": {
          "type": "string",
          "description": "The status of the order (e.g., Pending, Processing, Delivered)."
        },
        "createdAt": {
          "type": "string",
          "description": "The date and time when the order was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "customerName",
        "phone",
        "address",
        "items",
        "total",
        "status",
        "createdAt"
      ]
    },
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the Shaaban Furniture platform.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the User entity."
        },
        "role": {
          "type": "string",
          "description": "The user's role (e.g., admin, customer)."
        },
        "styleProfile": {
          "type": "string",
          "description": "Style profile of the user. Used for personalized recommendations."
        }
      },
      "required": [
        "id",
        "role"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous",
      "google.com"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "products/{productId}",
        "definition": {
          "entityName": "Product",
          "schema": {
            "$ref": "#/backend/entities/Product"
          },
          "description": "Stores product information. Accessible for viewing by everyone. Only admins can create, edit, or delete products.",
          "params": [
            {
              "name": "productId",
              "description": "Unique identifier for the product."
            }
          ]
        }
      },
      {
        "path": "users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profile information. Accessible only by the user and admins.",
          "params": [
            {
              "name": "userId",
              "description": "Unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "users/{userId}/orders/{orderId}",
        "definition": {
          "entityName": "Order",
          "schema": {
            "$ref": "#/backend/entities/Order"
          },
          "description": "Stores order information for each user. Accessible only by the user and admins.",
          "params": [
            {
              "name": "userId",
              "description": "Unique identifier for the user."
            },
            {
              "name": "orderId",
              "description": "Unique identifier for the order."
            }
          ]
        }
      },
      {
        "path": "roles_admin/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Marks a user as an admin. The existence of a document here grants admin privileges.",
          "params": [
            {
              "name": "userId",
              "description": "Unique identifier for the admin user."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to support the Shaaban Furniture e-commerce platform, emphasizing security, scalability, and ease of management. It incorporates denormalization to achieve authorization independence and facilitates robust security rules. The structure is segregated to maintain a homogeneous security posture within each collection.\n\nProducts: Products are stored in a top-level `products` collection, allowing for easy listing and filtering. No user-specific data is stored here, so no denormalization is required.\n\nOrders: Orders are stored within a subcollection of `users` ( `/users/{userId}/orders/{orderId}`). This allows customers to only view their own orders. Admin access to all orders will be controlled via a separate `roles_admin` collection.\n\nUsers: User roles are managed through a combination of path-based ownership for user-specific data (orders) and a global `roles_admin` collection. User profiles are stored in the `/users/{userId}` document. The `User` document does NOT contain the role to prevent the need for constant updates and to simplify security rules.  Admin status is checked via the existence of a document with the user's ID in the `roles_admin` collection.\n\nSecurity Rules and QAPs: The structure supports secure `list` operations by segregating data based on ownership (user orders) and administrative roles. Rules will check for the existence of a document in `/roles_admin/{userId}` to grant admin privileges. User orders are secured via path-based rules, ensuring that only the authenticated user (or an admin) can access their orders.\n\nAuthorization Independence: Authorization independence is achieved by avoiding `get()` calls in security rules. Instead, authorization is based on the authenticated user's ID and the document path, or, in the case of admin privileges, the existence of a document in the `roles_admin` collection.  This allows for atomic operations and easier debugging.\n\nThe structure aligns with the core design principles by prioritizing authorization independence, clarity of intent, DBAC, QAPs, and invariants. It leverages structural segregation and access modeling to create a secure and manageable database."
  }
}